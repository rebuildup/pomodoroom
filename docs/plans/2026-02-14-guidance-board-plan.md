# Guidance Board + Notifications Design

## Phase 0: Constraints & Alignment

The work is organized into the phases you requested: (1) guidance board layout, timer, and NEXT countdown/notification controls, (2) CURRENT FOCUS presentation + control surface adjustments, (3) automatic start-time recalculation / notification timing, and (4) a richer project/group/task model so tasks can belong to multiple containers and link to project references. The existing surface is driven by `GuidanceBoard`, `TaskCard`, and `TaskOperations` in `src/components/m3`; timers and notification state live in `src/views` + `src/hooks` (e.g., `useTauriTimer`, `useActionNotification`). Back-end data is stored in `pomodoroom-core` and surfaced through the Tauri bridge (`src-tauri/src/*.ts`) before hitting the front-end stores (`useTaskStore`). As I detail the UI changes, I will describe what scheduler inputs must change so the countdown, NEXT pane, and notifications stay accurate, then loop back with the data model shifts required for groups/projects. Does this scope check out before I move into the guidance-board UI outline?

## Phase 1: Guidance Board UI and Countdown/Notifications

The left timer panel needs a tighter height (per the request to reduce vertical space) with the countdown always referencing the next start, showing live countdown + date/time on a single line, and keeping the progress circle aligned vertically. The NEXT column should default to a row of three minimal task cards with border accents, no START/TEST text, but clicking anywhere replaces the panel with the control layout that only appears when NEXT is activated; without selection it stays in the simple mode. In control mode the header shows task title + time (right-aligned) and state icons; the control row is bottom-aligned, composed of clear buttons that open the notification window (START, RESCHEDULE, POSTPONE). There should be no nested task card click behavior that opens edit mode—taps only change selection or trigger notifications. The countdown logic will reuse `getNextTaskCountdownMs` but will now keep counting down until the next actual start (rather than freezing) and feed both the timer text and the new notification window trigger. The circular progress should display countdown progress, larger radius to match the new layout, and the panel width will be narrower overall. Does this guidance-board UI and auto-countdown plan feel right so far?

## Phase 2: CURRENT FOCUS Control Surface

CURRENT FOCUS now always displays the anchor task panel on the left (without emerging task cards) with bold text on a single line for title/time, a right-aligned timestamp, and control buttons underneath but aligned to the bottom. Clicking other running task cards should only shift the anchor selection, not open a detail view. The right side still shows secondary running tasks as cards with status icons and minimal info; their internal buttons (e.g., Extend) should open the shared notification dialog. The anchor panel will render running task data plus the necessary control switches (Complete, Interrupt→dialog, Extend, etc.) and a per-card circular progress in the CURRENT FOCUS grid, as requested. We also need to ensure completion operations actually mark tasks as done via the TaskOperations flow, and that the interrupt button now opens a dialog that forces the user to choose a resume time (with schedule-based recommendations). Do these CURRENT FOCUS updates capture the required interaction changes?

## Phase 3: Scheduling, Notifications, and Data Model

The backend scheduling logic (auto-schedule time utilities, scheduler modules, Tauri commands) must recompute estimated start timestamps whenever any task's schedule properties change—this means the earlier `estimatedMinutes` notion will be renamed to represent a start time (e.g., `estimatedStartAt`) and be recalculated on edit/insert/delete, not just duration. The NEXT panel, countdown, and notification window will all read that value to know when a task truly starts; when the timer hits zero we fire the start notification and set the task to running. The notification dialog itself should reuse the existing dedicated notification window (opened on START, PAUSE, POSTPONE, INTERRUPT actions) and close cleanly after action selection, even if the user cancels. Project/group refinements require a new data shape where each project owns metadata + references (docs, files) and tasks hold arrays of group IDs and project IDs. This structure will drive the UI choices (e.g., project reference badges and filters) and needs accompanying tests for schedule calculation, NEXT selection, and notification handling. Will this plan for the backend/model changes and notification wiring cover everything you expect?
